<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Подсчёт зарплаты (онлайн)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 30px;
  }
  h1 {
    color: #333;
  }
  .card {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    width: 330px;
  }
  input, button {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    font-size: 16px;
  }
  button {
    background-color: #0078d7;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover {
    background-color: #005fa3;
  }
  .result {
    margin-top: 20px;
    font-size: 18px;
  }
</style>
</head>
<body>

<h1>Подсчёт зарплаты</h1>

<div class="card">
  <label>Дата (по умолчанию сегодня):</label>
  <input type="date" id="dateInput">

  <label>Добавить аванс или полученную з/п:</label>
  <input type="number" id="amountInput" placeholder="Введите сумму">
  <button id="addBtn">Добавить</button>

  <div class="result">
    <p>Начислено: <span id="totalSalary">0</span> ₸</p>
    <p>Выдано: <span id="paidOut">0</span> ₸</p>
    <p><strong>Остаток: <span id="remaining">0</span> ₸</strong></p>
  </div>
</div>

<script type="module">
// === Подключение Firebase ===
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

// === Конфигурация Firebase ===
const firebaseConfig = {
  apiKey: "AIzaSyDNk1We9du5BJyrgGbQrkqd7tSDscneIOA",
  authDomain: "gold-11fa4.firebaseapp.com",
  databaseURL: "https://gold-11fa4-default-rtdb.firebaseio.com",
  projectId: "gold-11fa4",
  storageBucket: "gold-11fa4.firebasestorage.app",
  messagingSenderId: "226774330161",
  appId: "1:226774330161:web:d1e1c93ade5dcea31d5e10",
  measurementId: "G-7MLLBN1YZ4"
};

// === Инициализация ===
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// === Настройки ===
const dailyRate = 15000;
const holidayRate = 20000;

// Праздничные дни Казахстана (месяц-день)
const holidays = [
  "01-01", "01-02", "03-08", "03-21", "03-22", "03-23",
  "05-01", "05-07", "05-09", "07-06", "08-30", "10-25", "12-16", "12-17"
];

// Устанавливаем сегодняшнюю дату
const today = new Date();
document.getElementById('dateInput').valueAsDate = today;

// Ссылка на документ в Firestore
const salaryDoc = doc(db, "salaryData", "main");

// === Функции ===
function isHoliday(date) {
  const mmdd = date.toISOString().slice(5, 10);
  return holidays.includes(mmdd);
}

function calculateSalary(startDate) {
  const now = new Date();
  let total = 0;
  let d = new Date(startDate);
  while (d <= now) {
    total += isHoliday(d) ? holidayRate : dailyRate;
    d.setDate(d.getDate() + 1);
  }
  return total;
}

// === При изменении базы — сразу обновляем данные на странице ===
onSnapshot(salaryDoc, (docSnap) => {
  if (docSnap.exists()) {
    const data = docSnap.data();
    const totalSalary = calculateSalary(new Date(data.startDate));
    const paidOut = data.paidOut || 0;
    updateDisplay(totalSalary, paidOut);
  } else {
    // если нет данных, создаём с текущей даты
    setDoc(salaryDoc, { startDate: today.toISOString().split("T")[0], paidOut: 0 });
  }
});

// === Добавление транзакции ===
document.getElementById('addBtn').addEventListener('click', async () => {
  const amount = Number(document.getElementById('amountInput').value);
  if (!amount) return alert("Введите сумму!");
  
  const snap = await getDoc(salaryDoc);
  if (!snap.exists()) return alert("Данные ещё не созданы!");
  
  const data = snap.data();
  const newPaid = (data.paidOut || 0) + amount;

  await updateDoc(salaryDoc, { paidOut: newPaid });
  document.getElementById('amountInput').value = "";
});

// === Обновление отображения ===
function updateDisplay(totalSalary, paidOut) {
  document.getElementById("totalSalary").textContent = totalSalary.toLocaleString();
  document.getElementById("paidOut").textContent = paidOut.toLocaleString();
  document.getElementById("remaining").textContent = (totalSalary - paidOut).toLocaleString();
}
</script>

</body>
</html>

